{% extends "base.html" %}

{% block title %}–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <h1 class="mb-4">üìã –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h1>

    {% if borrowings %}
      <div class="table-responsive shadow-sm">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>–ö–Ω–∏–≥–∞</th>
              <th>–ê–≤—Ç–æ—Ä</th>
              <th>–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</th>
              <th>–î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {% for b in borrowings %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>
                <a href="{% url 'book_detail' b.book.id %}" class="text-decoration-none">
                  {{ b.book.title }}
                </a>
              </td>
              <td>{{ b.book.author }}</td>
              <td>{{ b.date_from|date:"d.m.Y" }}</td>
              <td>
                {% if b.date_to %}
                  {{ b.date_to|date:"d.m.Y" }}
                {% else %}
                  <span class="text-muted">‚Äî</span>
                {% endif %}
              </td>
              <td>
                {% if b.is_returned %}
                  <span class="badge bg-success">‚úÖ –í–æ–∑–≤—Ä–∞—â–µ–Ω–∞</span>
                {% else %}
                  <span class="badge bg-warning text-dark">üìñ –£ –≤–∞—Å</span>
                {% endif %}
              </td>
              <td>
                {% if not b.is_returned %}
                  <a href="{% url 'delete_borrowing' b.id %}" 
                     class="btn btn-sm btn-danger" 
                     onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                  </a>
                {% else %}
                  <span class="text-muted">‚Äî</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="row mt-4">
        <div class="col-md-4">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">–í—Å–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h5>
              <p class="display-6 text-primary">{{ borrowings.count }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">–ê–∫—Ç–∏–≤–Ω—ã—Ö</h5>
              <p class="display-6 text-warning">
                {% with active=borrowings|length %}
                  {% for b in borrowings %}
                    {% if not b.is_returned %}
                      {% if forloop.first %}1{% else %}{{ forloop.counter }}{% endif %}
                    {% endif %}
                  {% endfor %}
                {% endwith %}
              </p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ</h5>
              <p class="display-6 text-success">
                {% with returned=0 %}
                  {% for b in borrowings %}
                    {% if b.is_returned %}
                      {{ forloop.counter }}
                    {% endif %}
                  {% endfor %}
                {% endwith %}
              </p>
            </div>
          </div>
        </div>
      </div>
    {% else %}
      <div class="alert alert-info text-center py-5">
        <h4>üìö –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h4>
        <p class="mb-3">–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥ –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à—É—é—Å—è –∫–Ω–∏–≥—É!</p>
        <a href="{% url 'book_list' %}" class="btn btn-primary">
          –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥—É –∫–Ω–∏–≥
        </a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

